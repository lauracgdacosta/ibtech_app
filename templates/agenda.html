<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Módulo de Agenda</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js'></script>
    
    <style>
        .fc {
            max-width: 100%;
            margin: 20px auto;
        }
        /* Adiciona um cursor de ponteiro para indicar que os eventos são clicáveis */
        .fc-event-main {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div style="background-color: #34495e; color: white; padding: 10px 20px; text-align: right; margin-bottom: 15px;">
        {% if session.user_name %}
            <span>Bem-vindo, <strong>{{ session.user_name }}</strong>!</span>
            <a href="{{ url_for('logout') }}" style="color: #ecf0f1; margin-left: 15px; text-decoration: none;">Sair</a>
        {% endif %}
    </div>

    <div class="container">
        <div class="header-actions">
            <h1>Módulo de Agenda</h1>
            <div class="actions-group">
                {% if check_permission('agenda', 'can_edit') %}
                    <a href="{{ url_for('new_agenda') }}" class="button new">Novo Agendamento</a>
                {% endif %}
                <a href="{{ url_for('index') }}" class="button">Voltar ao Painel</a>
            </div>
        </div>
        
        <div id='calendar'></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            locale: 'pt-br',
            buttonText: {
                today: 'Hoje',
                month: 'Mês',
                week: 'Semana',
                day: 'Dia'
            },
            events: '/api/agendamentos',

            // --- ALTERAÇÃO APLICADA AQUI ---
            // Ação ao clicar em um evento: redireciona para a página de edição
            eventClick: function(info) {
                // Previne o comportamento padrão do clique
                info.jsEvent.preventDefault();
                
                // Obtém o ID do evento clicado
                var eventId = info.event.id;
                
                // Constrói a URL de edição e redireciona o usuário
                window.location.href = `/edit_agenda/${eventId}`;
            }
        });

        calendar.render();
    });
    </script>
</body>
</html>