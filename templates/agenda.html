<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Módulo de Agenda</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js'></script>
    
    <style>
        /* Ajustes para o calendário preencher o container */
        .fc {
            max-width: 1100px;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <div style="background-color: #34495e; color: white; padding: 10px 20px; text-align: right; margin-bottom: 15px;">
        {% if session.user_name %}
            <span>Bem-vindo, <strong>{{ session.user_name }}</strong>!</span>
            <a href="{{ url_for('logout') }}" style="color: #ecf0f1; margin-left: 15px; text-decoration: none;">Sair</a>
        {% endif %}
    </div>

    <div class="container">
        <div class="header-actions">
            <h1>Módulo de Agenda</h1>
            <div class="actions-group">
                {% if check_permission('agenda', 'can_edit') %}
                    <a href="{{ url_for('new_agenda') }}" class="button new">Novo Agendamento</a>
                {% endif %}
                <a href="{{ url_for('index') }}" class="button">Voltar ao Painel</a>
            </div>
        </div>
        
        <div id='calendar'></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Seleciona o elemento onde o calendário será renderizado
        var calendarEl = document.getElementById('calendar');

        // Cria e configura a instância do FullCalendar
        var calendar = new FullCalendar.Calendar(calendarEl, {
            // Define a visualização inicial como mês
            initialView: 'dayGridMonth',
            
            // Configura os botões do cabeçalho (anterior, próximo, hoje, etc.)
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            
            // Define o idioma para Português do Brasil
            locale: 'pt-br',
            buttonText: {
                today: 'Hoje',
                month: 'Mês',
                week: 'Semana',
                day: 'Dia'
            },

            // O mais importante: define a fonte de eventos como nossa nova API
            events: '/api/agendamentos',

            // (Opcional) Ação ao clicar em um evento
            eventClick: function(info) {
                // Monta uma mensagem com os detalhes do evento
                let detalhes = `Cliente: ${info.event.title}\n` +
                               `Data: ${info.event.start.toLocaleDateString()}\n` +
                               `Motivo: ${info.event.extendedProps.motivo}\n` +
                               `Status: ${info.event.extendedProps.status}\n\n` +
                               `${info.event.extendedProps.descricao || ''}`;
                
                alert(detalhes);

                // Previne o navegador de seguir um link (se houver)
                info.jsEvent.preventDefault();
            }
        });

        // Renderiza o calendário
        calendar.render();
    });
    </script>
</body>
</html>