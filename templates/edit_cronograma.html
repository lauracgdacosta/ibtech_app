<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Módulo de Cronograma</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div style="background-color: #34495e; color: white; padding: 10px 20px; text-align: right; margin-bottom: 15px;">
    {% if session.user_name %}
        <span>Bem-vindo, <strong>{{ session.user_name }}</strong>!</span>
        <a href="{{ url_for('logout') }}" style="color: #ecf0f1; margin-left: 15px; text-decoration: none;">Sair</a>
    {% endif %}
    </div>
    <div class="container">
        <div class="header-actions">
            <h1>Módulo de Cronograma</h1>
            <div class="actions-group">
                <a href="{{ url_for('index') }}" class="button">Voltar para o Início</a>
            </div>
        </div>

        <h2>Adicionar Novo Cronograma</h2>
        <form action="{{ url_for('cronograma') }}" method="post">
            <label for="equipe">Equipe:</label>
            <input type="text" id="equipe" name="equipe">

            <label for="tecnico_nome">Nome do Técnico:</label>
            <input type="text" id="tecnico_nome" name="tecnico_nome">
            
            <label for="tecnico_funcao">Função do Técnico:</label>
            <input type="text" id="tecnico_funcao" name="tecnico_funcao">

            <label for="atividade_domingo">Domingo:</label>
            <textarea id="atividade_domingo" name="atividade_domingo"></textarea>
            
            <label for="atividade_segunda">Segunda:</label>
            <textarea id="atividade_segunda" name="atividade_segunda"></textarea>

            <label for="atividade_terca">Terça:</label>
            <textarea id="atividade_terca" name="atividade_terca"></textarea>
            
            <label for="atividade_quarta">Quarta:</label>
            <textarea id="atividade_quarta" name="atividade_quarta"></textarea>
            
            <label for="atividade_quinta">Quinta:</label>
            <textarea id="atividade_quinta" name="atividade_quinta"></textarea>
            
            <label for="atividade_sexta">Sexta:</label>
            <textarea id="atividade_sexta" name="atividade_sexta"></textarea>
            
            <label for="atividade_sabado">Sábado:</label>
            <textarea id="atividade_sabado" name="atividade_sabado"></textarea>

            <button type="submit" class="button new">Salvar Cronograma</button>
        </form>

        <hr>

        <h2>Cronogramas Cadastrados</h2>
        <div class="controls">
            <input type="text" id="filterInput" placeholder="Filtrar por nome...">
            <select id="sortSelect">
                <option value="2">Ordenar por Técnico (A-Z)</option>
                <option value="2_desc">Ordenar por Técnico (Z-A)</option>
                <option value="1">Ordenar por Equipe (A-Z)</option>
                <option value="1_desc">Ordenar por Equipe (Z-A)</option>
            </select>
        </div>
        <button onclick="abrirTelaCheia('tabela-cronogramas')">Abrir Tabela em Tela Cheia</button>
        <table id="tabela-cronogramas">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Equipe</th>
                    <th>Nome do Técnico</th>
                    <th>Função do Técnico</th>
                    <th>Segunda</th>
                    <th>Terça</th>
                    <th>Quarta</th>
                    <th>Quinta</th>
                    <th>Sexta</th>
                    <th>Sábado</th>
                    <th>Domingo</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for cronograma in cronogramas %}
                <tr>
                    <td>{{ cronograma[0] }}</td>
                    <td>{{ cronograma[1] }}</td>
                    <td>{{ cronograma[2] }}</td>
                    <td>{{ cronograma[3] }}</td>
                    <td>{{ cronograma[4] }}</td>
                    <td>{{ cronograma[5] }}</td>
                    <td>{{ cronograma[6] }}</td>
                    <td>{{ cronograma[7] }}</td>
                    <td>{{ cronograma[8] }}</td>
                    <td>{{ cronograma[9] }}</td>
                    <td>{{ cronograma[10] }}</td>
                    <td class="actions">
                        <a href="{{ url_for('edit_cronograma', id=cronograma[0]) }}" class="button edit">Editar</a>
                        <form action="{{ url_for('delete_cronograma', id=cronograma[0]) }}" method="post">
                            <button type="submit" class="button delete" onclick="return confirm('Tem certeza que deseja excluir este cronograma?');">Excluir</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <script>
        function setupTable(tableId, filterInputId, sortSelectId) {
            const table = document.getElementById(tableId);
            if (!table) return;
            const filterInput = document.getElementById(filterInputId);
            const sortSelect = document.getElementById(sortSelectId);
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            function filterAndSort() {
                const filterText = filterInput.value.toLowerCase();
                const [sortCol, sortDir] = sortSelect.value.split('_');

                const visibleRows = rows.filter(row => {
                    const textContent = row.textContent.toLowerCase();
                    return textContent.includes(filterText);
                });

                visibleRows.sort((a, b) => {
                    const aText = a.children[parseInt(sortCol)].textContent.trim().toLowerCase();
                    const bText = b.children[parseInt(sortCol)].textContent.trim().toLowerCase();
                    if (aText < bText) return sortDir === 'desc' ? 1 : -1;
                    if (aText > bText) return sortDir === 'desc' ? -1 : 1;
                    return 0;
                });

                tbody.innerHTML = '';
                visibleRows.forEach(row => tbody.appendChild(row));
            }

            filterInput.addEventListener('input', filterAndSort);
            sortSelect.addEventListener('change', filterAndSort);
            filterAndSort();
        }

        document.addEventListener('DOMContentLoaded', () => {
            setupTable('tabela-cronogramas', 'filterInput', 'sortSelect');
        });

        function abrirTelaCheia(idTabela) {
            var tabela = document.getElementById(idTabela);
            if (tabela.requestFullscreen) {
                tabela.requestFullscreen();
            } else if (tabela.webkitRequestFullscreen) {
                tabela.webkitRequestFullscreen();
            } else if (tabela.msRequestFullscreen) {
                tabela.msRequestFullscreen();
            }
        }
    </script>
</body>
</html>