<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Checklist do Projeto</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .task-completed { text-decoration: line-through; color: #95a5a6; }
        .task-completed td { background-color: #f8f9f9; }
        .task-header {
            background-color: #eef2f5;
            font-weight: bold;
            color: #2c3e50;
        }
        .task-header td {
            border-bottom: 2px solid #3498db;
        }
        .add-task-form {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            align-items: flex-end;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #fdfdfd;
            border: 1px solid #f0f4f7;
            border-radius: 8px;
        }
        .form-full-width { grid-column: 1 / -1; }
        .form-button { align-self: end; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Tarefas do Projeto</h2>
        <table>
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Atividade</th>
                    <th>Datas</th>
                    <th>Duração</th>
                    <th>Responsáveis</th>
                    <th>Local</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for tarefa in tarefas %}
                    {% if tarefa['tipo'] == 'tarefa' %}
                        <tr class="{% if tarefa['status'] == 'Concluída' %}task-completed{% endif %}">
                            <td>{{ tarefa['atividade_id'] }}</td>
                            <td>
                                {{ tarefa['descricao'] }}
                                {% if tarefa['observacoes'] %}
                                    <p style="font-size: 0.9em; color: #7f8c8d; margin: 5px 0 0 0;">Obs: {{ tarefa['observacoes'] }}</p>
                                {% endif %}
                            </td>
                            <td>{{ tarefa['data_inicio'] | dateformat }} - {{ tarefa['data_termino'] | dateformat }}</td>
                            <td>{{ tarefa['duracao_calculada'] }}</td>
                            <td><b>PM:</b> {{ tarefa['responsavel_pm'] }}<br><b>CM:</b> {{ tarefa['responsavel_cm'] }}</td>
                            <td>{{ tarefa['local_execucao'] }}</td>
                            <td>
                                <form action="{{ url_for('toggle_tarefa_status', tarefa_id=tarefa['id']) }}" method="post" style="margin:0;">
                                     <button type="submit" class="button" style="padding: 8px 12px; width: 100%; background-color: {% if tarefa['status'] == 'Concluída' %}#2ecc71{% else %}#bdc3c7{% endif %};">
                                        {{ tarefa['status'] }}
                                    </button>
                                </form>
                            </td>
                            <td class="actions">
                                <a href="{{ url_for('edit_tarefa', tarefa_id=tarefa['id']) }}">Editar</a>
                                <form action="{{ url_for('delete_tarefa', tarefa_id=tarefa['id']) }}" method="post" onsubmit="return confirm('Tem certeza?');" style="display:inline;">
                                     <button type="submit">Excluir</button>
                                </form>
                            </td>
                        </tr>
                    {% else %}
                        <tr class="task-header">
                            <td colspan="8">
                                {{ tarefa['atividade_id'] }} {{ tarefa['descricao'] }}
                            </td>
                        </tr>
                    {% endif %}
                {% else %}
                <tr><td colspan="8" style="text-align:center;">Nenhuma tarefa adicionada.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>